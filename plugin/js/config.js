/*! For license information please see config.js.LICENSE.txt */
(()=>{var e={82:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSecretItem=t.FieldType=void 0,function(e){e[e.Dropdown=0]="Dropdown",e[e.Dropdown_FieldSelect=1]="Dropdown_FieldSelect",e[e.Radio=2]="Radio",e[e.Text=3]="Text",e[e.Number=4]="Number",e[e.MultilineText=5]="MultilineText",e[e.Checkbox=6]="Checkbox",e[e.IncrementalTable=7]="IncrementalTable",e[e.Label=8]="Label",e[e.Separator=9]="Separator"}(t.FieldType||(t.FieldType={})),t.isSecretItem=function(e){return"secret"in e}},518:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigBuilder=void 0,n(754);const l=n(796),r=n(787),o=n(82),s=n(505),a=n(128);class c{constructor(e,t){i(this,"props",void 0),i(this,"layout",void 0),i(this,"config",void 0),i(this,"field_builder",void 0),this.props=e,this.config=t,this.field_builder=new s.FieldBuilder(e)}static is_layout_info(e){return!!c.LAYOUT_PARTS.includes(e)}static is_includes_layout_info(e){return e.reduce(((e,t)=>(c.is_layout_info(t)&&(e=!0),e)),!1)}build_incremental_table(e,t){const n=new a.IncrementalTableBuilder(e,t,this.field_builder).build(),i=e.table_cols.map((e=>{const t=l.Utils.createElement("span","title");t.textContent=e.header;return l.Utils.createElement("th","kintoneplugin-table-th",[t])}));i.push(l.Utils.createElement("th","kintoneplugin-table-th-blankspace"));const r=l.Utils.createElement("tr","",i),o=l.Utils.createElement("thead","",[r]),s=l.Utils.createElement("tbody","",n);return l.Utils.createElement("table","kintoneplugin-table ms-0",[o,s],"",{id:"table-".concat(e.code)})}static get_grand_tr(e){if(null==e)throw"ERROR: nullが渡されたため祖父要素を取得できません";const t=e,n=null==t?void 0:t.parentNode;return null==n?void 0:n.parentNode}static get_formparts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n={};for(const i in e){if(!e.hasOwnProperty(i))continue;const l=e[i],r=l.label,o=l.code,s=l.type;t.includes(s)&&(n[o]={code:o,label:r,option:s})}const i=Object.keys(n).map((e=>({key:e,value:n[e]}))).sort(((e,t)=>e.value.label.toString().toLowerCase()<t.value.label.toString().toLowerCase()?-1:e>t?1:0));return Object.assign({},...i.map((e=>({[e.key]:e.value}))))}static addOnChangeEvent(e){for(const t of e)t.addEventListener("change",(e=>{const t=e.target;if(null==t)return;const n=t[t.selectedIndex];let i=n.getAttribute("option");null==i&&(i="");let l=n.getAttribute("code");null==l&&(l="");const r=t.closest("tr");if(null==r)return;const o=r.getElementsByTagName("input");o[0].value=i,o[1].value=l}))}build_fields_dropdown(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=l.Utils.createElement("select","select-kintone-field");if(s.id=i,null!=r){const e=l.Utils.createElement("option");e.label=r,s.appendChild(e)}const a=c.get_formparts(e,t);return this.field_builder.compose_fielditems(a,n,o).forEach((e=>{s.appendChild(e)})),l.Utils.createElement("div","",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[s])])])}async build_fields_dropdown_other_app(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(null==e||e==r.ConfigUtilities.DEFAULT_OPTION){const e=l.Utils.createElement("select","select-kintone-field");if(e.id=i,null!=o){const t=l.Utils.createElement("option");t.label=o,e.appendChild(t)}return l.Utils.createElement("div","",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[e])])])}const s=await kintone.api("/k/v1/app/form/fields","GET",{app:parseInt(e)});return this.build_fields_dropdown(s.properties,t,n,i,o)}static make_parts_block(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=l.Utils.buildElement({tagName:"div",className:"mb-3",innerHTML:n}),a=l.Utils.buildElement({tagName:"div",className:"h4 mb-2",textContent:t});if(r){const e=l.Utils.buildElement({tagName:"span",className:"text-danger",textContent:"*"});a.appendChild(e)}if(o){const e=l.Utils.buildElement({tagName:"span",className:"badge bg-secondary rounded-pill ms-2",textContent:"secret"});a.appendChild(e)}return l.Utils.buildElement({tagName:"div",className:i+" ms-4 mt-4",childElements:[a,s,e]})}static addFieldSelectEvent(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;kintone.api("/k/v1/app/form/fields","GET",{app:n}).then((n=>{var r,o;const s=Object.keys(n.properties).map((e=>n.properties[e])).filter((e=>"SINGLE_LINE_TEXT"==e.type)).map((e=>({code:e.code,label:e.label,option:e.type}))).map((e=>{const t=l.Utils.createElement("option","");return t.label=e.label,t.setAttribute("code",e.code),t.setAttribute("option",e.option),e.code==i&&t.setAttribute("selected",""),t})),a=l.Utils.createElement("select","select-kintone-field",s);a.addEventListener("change",(e=>{var n;const i=e.target;if(null==i)return;const l=i[i.selectedIndex],r=c(l);null===(n=t.firstChild)||void 0===n||n.remove(),t.appendChild(r)}));const c=e=>{let t;e?(t=e.getAttribute("code"),null==t&&(t="")):t="";const n=l.Utils.createElement("input","kintoneplugin-input-text",[]);n.setAttribute("value",t),n.setAttribute("disabled","");return l.Utils.createElement("td","kintoneplugin-table-td-control",[l.Utils.createElement("div","kintoneplugin-table-td-control-value",[l.Utils.createElement("div","kintoneplugin-input-outer",[n])])])},d=l.Utils.createElement("div","kintoneplugin-table-td-control-value",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[a])])]);null===(r=e.firstChild)||void 0===r||r.remove(),e.appendChild(d),null===(o=t.firstChild)||void 0===o||o.remove();const u=a.item(a.selectedIndex),p=c(u);t.appendChild(p)}))}static set_switch_event(e,t,n){e.querySelectorAll('input[type="radio"]').forEach((e=>{e.addEventListener(t,n)}))}make_string_block(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");const n=e.code,i=this.get_saved_value(this.config,e),r="".concat(t,"-").concat(n),s=l.Utils.createElement("div","kintoneplugin-input-outer",[l.Utils.ce("input","kintoneplugin-input-text",[],"",{type:t,id:r,value:i})]),a="required"in(d=e)&&1==d.required;var d;const u=(e=>!!(0,o.isSecretItem)(e)&&("secret"in e&&1==e.secret))(e);return c.make_parts_block(s,e.label,e.desc,"",a,u)}get_saved_value(e,t){if((0,o.isSecretItem)(t)){const e=kintone.plugin.app.getProxyConfig(t.URL,t.method);if(null==e)return"";let n=t.header;"Authorization Bearer"==n&&(n="Authorization");const i=t.data;if(null!=n){const t=e.headers[n];if(t.startsWith("Bearer")){return t.split(/ /)[1]}return t}if(null!=i)return e.data[i];throw new Error("get_saved_value(): 秘匿情報フィールドとして格納されている情報が不正です。(".concat(e,")"))}let n=e[t.code];return null==n&&(n=null!=t.default?t.default:""),n}make_multiline_block(e){if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");const t=e.code;let n=this.config[t];null==n&&(n=null!=e.default?e.default:"");const i="multiline-".concat(t),r=e.cols?e.cols.toString():"60",o=e.rows?e.rows.toString():"10",s=l.Utils.createElement("div","kintoneplugin-input-outer",[l.Utils.ce("textarea","",[],n,{id:i,rows:o,cols:r})]),a="required"in(d=e)&&1==d.required;var d;return c.make_parts_block(s,e.label,e.desc,"",a)}make_checkbox_block(e){if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");if(null==e||null==e.accept)throw new Error("ConfigBuidler.make_checkbox_block(): 必要なプロパティ accept が未定義です。設定を見直してください。");const t=e.code;let n=this.config[t];null==n&&(n=[]);const i="".concat(t),r=e.accept.map((e=>{const t="".concat(i,"-").concat(e),r={type:"checkbox",name:"checkbox",value:e,id:t};return n.includes(e)&&(r.checked="checked"),l.Utils.createElement("div","kintoneplugin-input-checkbox",[l.Utils.ce("span","kintoneplugin-input-checkbox-item",[l.Utils.ce("input","kintoneplugin-input-checkbox-item",[],"",r),l.Utils.ce("label","",[],e,{for:t})])])})),o="required"in(s=e)&&1==s.required;var s;return c.make_parts_block(l.Utils.ce("div","",r,"",{id:i}),e.label,e.desc,"",o)}make_radio_block(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");const n=e.code;let i=this.config[n];if(null==i&&null!=e.default&&(i=e.default),null==e||null==e.accept)throw new Error("ConfigBuidler.make_dropdown_fieldselect_block(): 必要なプロパティ accept が未定義です。設定を見直してください。");const r=e.accept.map((e=>{const t="radio-".concat(n,"-").concat(e),r="radio-".concat(n),o=l.Utils.createElement("input");o.setAttribute("type","radio"),o.setAttribute("name",r),o.setAttribute("value",e),o.setAttribute("id",t),e==i&&o.setAttribute("checked","checked");const s=l.Utils.createElement("label","",[],e);return s.setAttribute("for",t),l.Utils.createElement("span","kintoneplugin-input-radio-item",[o,s])})),o=l.Utils.createElement("div","kintoneplugin-input-radio",r);o.id=n;const s="required"in(a=e)&&1==a.required;var a;return c.make_parts_block(o,e.label,e.desc,t,s)}make_dropdown_fieldselect_block(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=[],i=[];if(null==e.accept)throw new Error("ConfigBuidler.make_dropdown_fieldselect_block(): 必要なプロパティ accept が未定義です。設定を見直してください。");if(e.accept.forEach((e=>{c.is_layout_info(e)?i.push(e):n.push(e)})),null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");if(i.length>0&&null==this.layout)throw new Error("レイアウト情報をロードしていません。load_layout_info() を事前に呼び出してください。");if(i.length>0&&n.length>0)throw new Error("フォーム情報のフィールドとレイアウト情報のフィールドとが混在したドロップダウンは構築できません。");const l=e.code,r=this.config[l];let o;const s=!!e.verbose&&e.verbose;if(n.length>0)o=this.build_fields_dropdown(this.props,n,r,l,e.default,s);else{if(!(i.length>0))throw new Error("[".concat(e.label,"] フォーム情報またはレイアウト情報が空欄で呼び出されました"));o=this.build_fields_dropdown(this.layout,i,r,l,e.default,s)}const a="required"in(d=e)&&1==d.required;var d;return c.make_parts_block(o,e.label,e.desc,t,a)}make_incremental_table_block(e){if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");const t=e.code,n=this.config[t],i=this.build_incremental_table(e,n);return c.make_parts_block(i,e.label,e.desc)}make_subtitle_block(e){const t=l.Utils.ce("div","display-6 mb-3",[],e.label),n=l.Utils.ce("div","ms-4 mt-2 mb-5",[],e.desc);return l.Utils.createElement("div","",[t,n])}async load_layout_info(){const e=(await kintone.api("/k/v1/preview/app/form/layout","GET",{app:kintone.app.getId()})).layout.reduce(((e,t)=>{if("GROUP"==t.type){const n=t.layout.reduce(((e,t)=>{const n=t.fields.filter((e=>"SPACER"==e.type));return e=e.concat(n)}),[]);e.concat(n)}else e=e.concat(t.fields.filter((e=>"SPACER"==e.type)));return e}),[]);this.layout=e.reduce(((e,t)=>(t.code=t.elementId,t.label=t.elementId,e[t.code]=t,e)),{})}}i(c,"LAYOUT_PARTS",["SPACER"]),t.ConfigBuilder=c},716:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigManager=void 0,n(754);const l=n(787),r=n(518),o=n(82),s=n(796);t.ConfigManager=class{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;i(this,"KEY_CONFIG","config"),i(this,"setting_input",void 0),i(this,"config",{}),i(this,"hooks",{});const l=kintone.plugin.app.getConfig(e);this.set_config(l),this.setting_input=t,n&&this.set_preference(n)}set_preference(e){const t=document.getElementById("plugin_title");t&&(t.textContent=e.title);const n=document.getElementById("plugin_description");n&&(n.textContent=e.description)}build(){kintone.api("/k/v1/preview/app/form/fields","GET",{app:kintone.app.getId()}).then((async e=>{const t=this.make_setting_fields(e.properties),n=this.make_button_submit(),i=this.make_button_cancel(),l=(async()=>{const e=s.Utils.createElement("form","",await t);return e.id="form_settings",e})(),r=document.getElementById("config_body");null==r||r.appendChild(await l);const o=s.Utils.createElement("div","mt-5",[i,n]);null==r||r.appendChild(o)})).then((e=>{this.call_target_event("load")})).catch((e=>{throw e}))}async call_target_event(e){const t=this.hooks[e];if(null!=t)for(const e of t)null!=e&&await e()}layout_inputs(e,t){return t.map((t=>this.make_paragraph(e,t)))}make_paragraph(e,t){switch(t.type){case o.FieldType.Text:return e.make_string_block(t);case o.FieldType.MultilineText:return e.make_multiline_block(t);case o.FieldType.Radio:return e.make_radio_block(t);case o.FieldType.Number:return e.make_string_block(t,"number");case o.FieldType.Checkbox:return e.make_checkbox_block(t);case o.FieldType.IncrementalTable:return e.make_incremental_table_block(t);case o.FieldType.Label:return e.make_subtitle_block(t);case o.FieldType.Separator:return s.Utils.createElement("div","mt-5 bg-info");case o.FieldType.Dropdown_FieldSelect:if(!("accept"in t))throw new Error("プロパティ accept が必要です。config/settings.ts の設定を見直してください。");return e.make_dropdown_fieldselect_block(t);default:throw new Error("未実装のFieldTypeを要求しています。".concat(t.type," を実装してください。"))}}set_config(e){const t=s.Utils.get_from(e,this.KEY_CONFIG,"");""==t||(this.config=JSON.parse(t))}get_config(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(null==e)return this.config;if(e in this.config)return this.config[e];throw new Error("未定義または未設定の設定キーが指定されました: [".concat(e,"]"))}async make_setting_fields(e){const t=new r.ConfigBuilder(e,this.config);return await t.load_layout_info(),this.layout_inputs(t,this.setting_input)}isSecretItem(e){return"secret"in e}secret_parameters(e){const t=this.setting_input.filter((e=>(0,o.isSecretItem)(e)));return this.make_proxy_params(t,e)}make_proxy_params(e,t){const n=e.reduce(((e,t)=>{const n=t.method+":"+t.URL;return null==e[n]&&(e[n]=[]),e[n].push(t),e}),{}),i=Object.keys(n).reduce(((e,i)=>{const l=n[i],r=e=>{const n=t.get_text_value(e.code);if("required"in e||(e.required=!1),1==e.required&&(null==n||null==n||""==n))throw new Error("必須の項目[".concat(e.label,"]が未記入です。"));return null==n||null==n?"":n},o=l.filter((e=>"header"in e)).reduce(((e,t)=>{const n=r(t);if(null==t.header)throw new Error("秘匿設定のheader要素が未定義です。");return"Authorization Bearer"==t.header?e.Authorization="Bearer "+n:e[t.header]=n,e}),{}),s=l.filter((e=>"data"in e)).reduce(((e,t)=>{const n=r(t);if(null==t.data)throw new Error("秘匿設定のdata要素が未定義です");return e[t.data]=n,e}),{}),a={URL:l[0].URL,method:l[0].method,headers:o,data:s};return e.push(a),e}),[]);return i}store_parameters(e){const t={};return this.setting_input.forEach((n=>{if(n.type==o.FieldType.Label||n.type==o.FieldType.Separator)return;if("secret"in n&&1==n.secret)return;const i=n.code,l=n.required,r=e.get_selected(i,n.type);if(r)t[i]=r;else{if(l){const e="必須の設定項目 [".concat(n.label,"] が未設定です(").concat(i,")");throw new Error(e)}t[i]=""}})),t}make_button_submit(){const e=s.Utils.createElement("button","kintoneplugin-button-dialog-ok");return e.setAttribute("type","button"),e.textContent="適用",e.addEventListener("keydown",(e=>{if(e.isComposing||"Enter"==e.code)return!1})),e.addEventListener("click",(async e=>{e.preventDefault();const t=document.getElementById("form_settings");if(null==t)throw"ERROR: フォーム要素を取得できませんでした。";await this.call_target_event("submit").catch((e=>{const t="⛔ 設定の保存でエラーが発生しました。（".concat(e,"）");throw alert(t),new Error(t)}));const n=new l.ConfigUtilities(t);let i,r;try{i=this.secret_parameters(n)}catch(t){const n="⛔ 設定値の保存でエラーが発生しました。設定値を見直してください。（".concat(t,"）");return alert(n),e}i.forEach((async e=>{kintone.plugin.app.setProxyConfig(e.URL,e.method,e.headers,e.data,(()=>{}))}));try{r=this.store_parameters(n),setTimeout((()=>{const e=JSON.stringify(r),t={};t[this.KEY_CONFIG]=e,kintone.plugin.app.setConfig(t)}),200)}catch(t){return alert("⛔ 設定値の保存でエラーが発生しました。設定値を見直してください。（".concat(t,"）")),e}})),e}make_button_cancel(){const e=s.Utils.createElement("button","js-cancel-button kintoneplugin-button-dialog-cancel");return e.textContent="キャンセル",e.addEventListener("click",(function(e){window.location.href="../../"+kintone.app.getId()+"/plugin/"})),e}add_hook(e,t){var n;null==this.hooks[e]&&(this.hooks[e]=[]),null===(n=this.hooks[e])||void 0===n||n.push(t)}}},787:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigUtilities=void 0;const l=n(796),r=n(82);class o{constructor(e){i(this,"config_form",void 0),i(this,"whole_selected_field_codes",void 0),i(this,"add_selected_field_codes",(e=>{this.whole_selected_field_codes.push(e)})),i(this,"get_selected_fieldcode",(e=>{const t=document.getElementById(e);if(-1==t.selectedIndex)return"";if(t.options[t.selectedIndex].label==o.DEFAULT_OPTION)return"";const n=t.selectedOptions[0].getAttribute("fieldcode");if(null==n)throw new Error("ノード[ ".concat(e," ]はフィールド選択ではありません。"));return n})),i(this,"get_selected_label",(e=>{const t=document.getElementById(e);if(null==t)throw new Error("ConfigUtilities.get_selected_label(): 指定のID'".concat(e,"'が null でした。"));return-1==t.selectedIndex?"":t.selectedOptions[0].label})),i(this,"get_checked_boxes",(e=>{const t=document.querySelectorAll('[id^="'.concat(e,'-"]'));if(0==t.length)throw new Error("ConfigUtilities.get_checked_boxes(): 指定のID'".concat(e,"-'から始まるチェックボックスが見つかりませんでした。"));return Array.from(t).reduce(((e,t)=>(t.checked&&e.push(t.value),e)),[])})),this.config_form=e,this.whole_selected_field_codes=[]}is_overlapped(e){return l.Utils.is_overlapped(this.overlapped(e))}overlapped(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return null!=e&&this.whole_selected_field_codes.concat(e),l.Utils.overlapped(this.whole_selected_field_codes)}clear_selected_field_labels(){this.whole_selected_field_codes=[]}get_selected_radio(e){const t="radio-".concat(e),n=document.getElementsByName(t),i=n.length;for(let e=0;e<i;e++){const t=n[e];if(1==t.checked)return t.value}return""}get_text_value(e){const t="text-".concat(e);return document.getElementById(t).value}get_multilinetext_value(e){const t="multiline-".concat(e);return document.getElementById(t).value}get_number_value(e){const t="number-".concat(e);return document.getElementById(t).value}get_incremental_table_values(e){const t="table-".concat(e),n=document.getElementById(t);if(null==n)throw new Error("指定したテーブルが見つかりません。(id: ".concat(t,")"));return this.abstruct_from_incremental_table(n)}abstruct_from_incremental_table(e){const t=Array.from(e.rows).filter((e=>{var t;return"TH"==(null===(t=e.firstChild)||void 0===t?void 0:t.nodeName)})).map((e=>Array.from(e.cells).filter((e=>""!=e.innerText)).map((e=>e.innerText)))),n=Array.from(e.rows).filter((e=>{var t;return"TH"!=(null===(t=e.firstChild)||void 0===t?void 0:t.nodeName)})).map((e=>Array.from(e.cells).filter((e=>{const t=e.getElementsByClassName("kintoneplugin-input-text")[0],n=e.getElementsByClassName("select-kintone-field")[0],i=e.getElementsByClassName("kintoneplugin-input-checkbox-item"),l=e.getElementsByClassName("kintoneplugin-multiline-text-inner")[0];return void 0!==t||void 0!==n||void 0!==i||null!=l})).map((t=>{const n=t.getElementsByClassName("kintoneplugin-input-text")[0];if(null!=n)return n.value;const i=t.getElementsByClassName("kintoneplugin-multiline-text-inner")[0];if(null!=i)return i.value;const l=t.getElementsByClassName("select-kintone-field")[0];if(null!=l){const e=l.selectedIndex,t=l[e];if("fieldcode"in l[e].attributes){const e=t.getAttribute("fieldcode");if(null!=e)return e}return l[e].label}const r=t.getElementsByClassName("kintoneplugin-input-checkbox");if(null!=r)return Array.from(r).filter((e=>e.childNodes[0].childNodes[0].checked)).map((e=>{if(null==e.textContent)throw new Error("ラベルのないチェックボックスが定義されています。");return e.textContent}));throw new Error("未対応のテーブルセル ".concat(e," が渡されました。"))})).filter((e=>!(Array.isArray(e)&&0==e.length)))));if(0==n.filter((e=>e.length>0)).filter((e=>e.filter((e=>(null!=e?e.length:0)>0)).length>0)).length)return null;const i=t[0];return n.map((e=>e.reduce(((e,t,n)=>{const l=null==t?"":t;return e[i[n]]=l,e}),{})))}get_selected(e,t){switch(t){case r.FieldType.Dropdown:return this.get_selected_label(e);case r.FieldType.Checkbox:return this.get_checked_boxes(e);case r.FieldType.Radio:return this.get_selected_radio(e);case r.FieldType.Dropdown_FieldSelect:return this.get_selected_fieldcode(e);case r.FieldType.Text:return this.get_text_value(e);case r.FieldType.Number:return this.get_number_value(e);case r.FieldType.MultilineText:return this.get_multilinetext_value(e);case r.FieldType.IncrementalTable:return this.get_incremental_table_values(e)}throw new Error("get_selected(): 不明なフィールドタイプが渡されました (field_type: ".concat(t,")"))}}i(o,"DEFAULT_OPTION","----"),t.ConfigUtilities=o},505:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.FieldBuilder=void 0;const l=n(796),r=n(82),o=n(518),s=n(787);t.FieldBuilder=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.ConfigUtilities.DEFAULT_OPTION;i(this,"props",void 0),i(this,"empty_label",void 0),i(this,"build_textcell",(e=>(e=void 0===e?"":e,l.Utils.createElement("div","kintoneplugin-input-outer",[l.Utils.createElement("input","kintoneplugin-input-text",[],void 0,{type:"text",value:e})])))),i(this,"build_checkbox_cell",((e,t,n,i)=>{const r=t.accept.map((t=>{const r="".concat(n,"-").concat(i,"-").concat(t),o=(e=void 0===e?[]:e).includes(t)?"checked":"",s=l.Utils.ce("input","",[],"",{type:"checkbox",name:"checkbox",value:t,id:r});return""!=o&&s.setAttribute("checked",o),l.Utils.ce("div","kintoneplugin-input-checkbox",[l.Utils.createElement("span","kintoneplugin-input-checkbox-item",[s,l.Utils.ce("label","",[],t,{for:r})])])}));return l.Utils.createElement("div","",r)})),i(this,"build_dropdown_cell",((e,t)=>{if(null==t||!("accept"in t))throw new Error("選択肢情報としてundefinedが渡されました。");e=void 0===e?"":e;const n=l.Utils.createElement("select","select-kintone-field");if(null!=t.empty_label){const e=l.Utils.createElement("option");e.label=t.empty_label,n.appendChild(e)}return t.accept.forEach((t=>{const i=l.Utils.createElement("option");i.label=t,t==e&&i.setAttribute("selected",""),n.appendChild(i)})),l.Utils.createElement("div","",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[n])])])})),i(this,"build_dropdown_fieldselect_cell",((e,t)=>{if(null==t||!("accept"in t))throw new Error("選択肢情報としてundefinedが渡されました。");const n=l.Utils.createElement("select","select-kintone-field");n.id=void 0===e?"":e;const i=l.Utils.createElement("option");i.label=this.empty_label,n.appendChild(i);const r=o.ConfigBuilder.get_formparts(this.props,t.accept),s=!!t.verbose&&t.verbose;return this.compose_fielditems(r,e,s).forEach((e=>{n.appendChild(e)})),l.Utils.createElement("div","",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[n])])])})),i(this,"build_multilinetext_cell",(e=>(e=void 0===e?"":e,l.Utils.createElement("div","kintoneplugin-input-outer",[l.Utils.ce("textarea","kintoneplugin-multiline-text-inner",[],e,{rows:"3",cols:"40"})])))),this.props=e,this.empty_label=t}build_table_cell(e,t,n,i){if("accept"in t)switch(t.type){case r.FieldType.Checkbox:return this.build_checkbox_cell(n,t,e,i);case r.FieldType.Dropdown:return this.build_dropdown_cell(n,t);case r.FieldType.Dropdown_FieldSelect:return this.build_dropdown_fieldselect_cell(n,t)}else switch(t.type){case r.FieldType.Text:return this.build_textcell(n);case r.FieldType.MultilineText:return this.build_multilinetext_cell(n,t)}throw new Error("未定義のFieldTypeが渡されました。FieldTypeに".concat(t.type," を実装してください。"))}compose_fielditems(e,t,n){const i=[];for(const r in e){const o=l.Utils.createElement("option"),s=e[r];o.setAttribute("fieldcode",r),o.label=n?s.label+" [".concat(r,"]"):s.label,r==t&&o.setAttribute("selected",""),i.push(o)}return i}}},128:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.IncrementalTableBuilder=void 0;const l=n(796),r=n(518);t.IncrementalTableBuilder=class{constructor(e,t,n){i(this,"table_conf",void 0),i(this,"saved_rows",void 0),i(this,"table_rows",void 0),i(this,"field_builder",void 0),i(this,"rows_count",void 0),this.table_conf=e,this.saved_rows=t,this.field_builder=n,this.table_rows=[],this.rows_count=0}build(){const e=this.table_conf.table_cols,t=e.length-3;return null==this.saved_rows||0==Object.keys(this.saved_rows).length?this.table_rows.push(this.build_table_row(0,e,void 0,t)):this.saved_rows.forEach(((n,i)=>{const l=this.build_table_row(i,e,n,t);this.table_rows.push(l)})),this.table_rows}build_table_row(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=[];for(let i=0;i<t.length;i++){const o=t[i],s=null==n?void 0:n[o.header],a=this.field_builder.build_table_cell(this.table_conf.code,o,s,e);r.push(l.Utils.ce("td","",[l.Utils.ce("div","kintoneplugin-table-td-control",[l.Utils.ce("div","kintoneplugin-table-td-control-value",[a])])]))}const o=this.create_button_row_add(t),s=this.create_button_row_remove();i=i<0?0:i;const a=[...Array(i)].map((()=>l.Utils.createElement("td","td_spacer"))),c=[...r,...a,l.Utils.createElement("td","kintoneplugin-table-td-operation",[o,s])];this.rows_count=r.length;return l.Utils.createElement("tr","",c)}get_table_rows_count(){const e="table-".concat(this.table_conf.code),t=document.getElementById(e);if(t)return t.getElementsByTagName("tr").length;throw new Error("指定したテーブルID ".concat(e," が存在しません。"))}create_button_row_add(e){const t=document.createElement("button");return t.className="kintoneplugin-button-add-row-image",t.setAttribute("type","button"),t.setAttribute("title","Add row"),t.addEventListener("click",(t=>{const n=r.ConfigBuilder.get_grand_tr(t.target),i=null==n?void 0:n.parentNode;if(null==n||null==i)throw"ERROR: 祖先のtbodyを取得できませんでした。";if(null==(null==t?void 0:t.target))return;const l=n.children.length-1-e.length,o=this.get_table_rows_count()+1,s=this.build_table_row(o,e,void 0,l);i.insertBefore(s,n.nextElementSibling)})),t}create_button_row_remove(){const e=document.createElement("button");return e.className="kintoneplugin-button-remove-row-image",e.setAttribute("type","button"),e.setAttribute("title","Delete this row"),e.addEventListener("click",(e=>{var t,n;const i=r.ConfigBuilder.get_grand_tr(e.target);1!=(null===(t=i.parentNode)||void 0===t?void 0:t.childNodes.length)&&(null===(n=i.parentNode)||void 0===n||n.removeChild(i))})),e}}},580:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),l=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),l(n(518),t),l(n(716),t),l(n(787),t),l(n(505),t),l(n(128),t),l(n(82),t)},754:e=>{e.exports={}},715:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonInstaller=void 0;const i=n(177);n(754);t.ButtonInstaller=class{class_hms_button="button-hms-items";buttons=[];canvas;constructor(e=""){""!=e&&(this.class_hms_button=e)}create_button(e,t=""){const n=i.Utils.ce("span","",[],e);n.style.color="dodgerblue";let l=i.Utils.ce("button",this.class_hms_button,[n],"",{title:t});return l=i.Utils.decorate_menu_icon(l),e.length>2&&(l.style.fontSize="16px"),l}add_button(e){this.buttons.push(e)}install(){this.already_installed()||0!=this.buttons.length&&this.put_buttons(this.buttons)}set_canvas(e){this.canvas=e}get_hms(){const e=kintone.app.getHeaderMenuSpaceElement();if(null==e){throw new Error("ボタン配置スペースが取得できませんでした。")}return e}already_installed(){return document.getElementsByClassName(this.class_hms_button).length>0}put_buttons(e){const t=void 0===this.canvas?this.get_hms():this.canvas;e.forEach((e=>{t.append(e)}))}get_header_element(e){const t=document.querySelectorAll(".recordlist-header-label-gaia");return Array.from(t).filter((t=>t.textContent==e))}}},796:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),l=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),l(n(177),t),l(n(715),t),l(n(23),t)},23:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluginCanvas=void 0;const i=n(177);n(754);class l{static CLASS_DISMISS="offcanvas-dismiss";id_island;id_offcanvas;title_offcanvas;island;enable_offcanvas;constructor(e,t,n=null,l){if(this.title_offcanvas=e,this.id_island=`plugin_island_id_${t}`,this.id_offcanvas=`offcanvas_${this.id_island}`,""==t){if(null==n&&(n=kintone.app.getHeaderMenuSpaceElement()),null==n)throw new Error("kintone.app.HeaderMenuSpaceElement() を取得できませんでした。");return this.island=n,void(this.enable_offcanvas=!1)}this.enable_offcanvas=!0;const r=document.getElementById(this.id_island);if(r)this.island=r;else{const e=(e=>{if(e)return e;{const e=i.Utils.ce("span","",[],"🎈");return e.style.cursor="pointer",e}})(l);e.style.color="dodgerblue";let t=i.Utils.ce("div","bbk-tool-icon-box",[e],"",{id:this.id_island,"data-bs-toggle":"offcanvas","aria-controls":this.id_offcanvas,"data-bs-target":`#${this.id_offcanvas}`});t=i.Utils.decorate_menu_icon(t),this.island=t,this.init_offcanvas()}}init_offcanvas(){const e=kintone.app.getHeaderMenuSpaceElement();e&&(e.appendChild(this.get_node()),e.appendChild(this.build_node_offcanvas()))}get_node(){return this.island}build_node_offcanvas(){return i.Utils.ce("div","offcanvas offcanvas-start",[i.Utils.ce("div","offcanvas-header",[i.Utils.ce("h5","offcanvas-title",[],this.title_offcanvas,{id:`${this.id_offcanvas}Label`}),i.Utils.ce("button","btn-close text-reset",[],"",{"data-bs-dismiss":"offcanvas","aria-label":"Close"})]),i.Utils.ce("div","offcanvas-body",[i.Utils.ce("div","mb-4",[],"ここから各種プラグインを呼び出せます。")],"",{id:`${this.id_offcanvas}-body`})],"",{tabindex:"-1",id:`${this.id_offcanvas}`,"aria-labelledby":`${this.id_offcanvas}Label`,"data-bs-backdrop":"false"})}append(e){if(this.enable_offcanvas){const t=document.getElementById(`${this.id_offcanvas}-body`);this.deal_dismiss_attribute(e),t?.appendChild(e)}else this.island.append(e)}deal_dismiss_attribute(e){const t=Array.from(e.querySelectorAll(`.${l.CLASS_DISMISS}`));t.length>0?t.map((e=>{e.setAttribute("data-bs-dismiss","offcanvas")})):e.setAttribute("data-bs-dismiss","offcanvas")}}t.PluginCanvas=l},177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;class n{static unique_properties(e,t=!1){const n=[];for(const i of Object.keys(e)){const l=e[i];(1==l.unique||t&&"RECORD_NUMBER"==l.type)&&n.push(l)}return n}static is_not_empty_string(e){return!n.is_empty_string(e)}static is_empty_string(e){return null==e||null==e||!(e.length>0)}static get_from=(e,t,n)=>e.hasOwnProperty(t)?e[t]:n;static buildElement=e=>{const t=e.tagName,i=e.className?e.className:"",l=e.childElements?e.childElements:[],r=e.textContent?e.textContent:void 0,o=e.innerHTML?e.innerHTML:void 0,s=e.attrs?e.attrs:{};return n.createElement(t,i,l,r,s,o)};static createElement=(e,t="",n=[],i,l,r)=>{const o=document.createElement(e);return o.className=t,null!=i&&(o.textContent=i),null!=r&&(o.innerHTML=r),n.length>0&&n.forEach((e=>{o.appendChild(e)})),l&&Object.entries(l).forEach((([e,t])=>{o.setAttribute(e,t)})),o};static ce=(e,t="",n=[],i="",l)=>this.createElement(e,t,n,i,l);static decorate_menu_icon(e){return e.style.height="48px",e.style.backgroundColor="#f7f9fa",e.style.fontSize="28px",e.style.border="1px solid #e3e7e8",e.style.display="inline",e.style.marginLeft="2px",e.style.marginRight="2px",e.style.verticalAlign="middle",e}static simpleDiv=e=>n.createElement("div","",[],e);static is_overlapped=e=>n.overlapped(e).length>0;static overlapped=e=>{const t=e.filter(((e,t,n)=>n.indexOf(e)!==n.lastIndexOf(e)));return Array.from(new Set(t))};static get_application_url(e){return`${location.protocol}//${location.host}/k/${e}`}static retrieve_errors(e,t=-1){const n=e?.error?.errors;if(null==n)return;let i=[];if(Object.keys(n).forEach((e=>{const t=n[e].messages.map((t=>`[${e}] ${t}`));i=i.concat(t)})),i.sort(),t>=0&&t<i.length){const e=i.length-t;i=i.splice(0,t),i.push(`以下${e}件のエラーメッセージを省略しました。`)}return i}}t.Utils=n}},t={};function n(i){var l=t[i];if(void 0!==l)return l.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}(()=>{"use strict";var e=n(580);const t={PLUGIN_NAME:"ChatGPT連携プラグイン",EMPTY_LABEL:"----",API_KEY:"api_key",MODEL_ID:"model_id",STATIC_PROMPT:"static_prompt",UNIQUE_PROMPT:"unique_prompt",INPUT_FIELD:"input_field",OUTPUT_FIELD:"output_field",BTN_SPACE_FIELD:"btn_space_field",FLAG_RECORD_MODIFIER:"flag_record_modifier",LABELS_RECORD_MODIFIER:["enable","disable"],NUMBER_MAX_TOKENS:"NUMBER_MAX_TOKENS",SYSTEM_PROMPT:"system_prompt",TABLE_FEWSHOTS_PROMPT:"table_fewshot_prompt",TABLE_FEWSHOTS:{role:"役割",content:"プロンプト"}};function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l{}i(l,"preference",{title:"ChatGPT連携プラグインの設定",description:""}),i(l,"input",[{label:"ChatGPTの設定",desc:"API呼び出しに必要な項目を指定します。",type:e.FieldType.Label},{label:"API Key",desc:"ChatGPT APIのAPI Tokenを指定してください。",code:t.API_KEY,type:e.FieldType.Text,required:!0,secret:!0,URL:"https://api.openai.com/v1/chat/completions",method:"POST",header:"Authorization Bearer"},{label:"ChatGPTの利用モデル",desc:'利用モデル名を入力してください。デフォルトは "gpt-3.5-turbo" です。',code:t.MODEL_ID,type:e.FieldType.Text,default:"gpt-3.5-turbo",required:!0},{label:"MAX Tokens",desc:"レスポンスの最大トークン長を指定してください。",code:t.NUMBER_MAX_TOKENS,type:e.FieldType.Number,default:"512",required:!0},{label:"役割プロンプト",desc:"ChatGPTの役割を与えます。あなたはカウンセラーです。のような役割をプロンプトしてください。",code:t.SYSTEM_PROMPT,type:e.FieldType.MultilineText,rows:3,cols:50,required:!1},{label:"対話例プロンプト",desc:"会話の例をChatGPTに教えます。この項目が長くなる場合はMAX Tokensの値を増やしてください。",code:t.TABLE_FEWSHOTS_PROMPT,type:e.FieldType.IncrementalTable,required:!1,table_cols:[{header:t.TABLE_FEWSHOTS.role,type:e.FieldType.Dropdown,accept:["user","assistant"]},{header:t.TABLE_FEWSHOTS.content,type:e.FieldType.MultilineText}]},{label:"",desc:"==============================================",type:e.FieldType.Separator,required:!1},{label:"プラグインの動作設定",desc:"ボタンの配置やレコード単位でプロンプトとして使用するフィールドなどを設定します。",type:e.FieldType.Label},{label:"実行ボタン配置スペース選択",desc:"API呼び出しを実行するボタンを配置するスペースを選択してください。",code:t.BTN_SPACE_FIELD,type:e.FieldType.Dropdown_FieldSelect,accept:["SPACER"],required:!0},{label:"[danger] レコード編集モード",desc:"有効にするとレコード全体を編集対象として書き換えるモードで動作します。その際、↓以降の設定は無効になります。よくわからない場合はdisableにしておいてください。",code:t.FLAG_RECORD_MODIFIER,type:e.FieldType.Radio,accept:t.LABELS_RECORD_MODIFIER,default:t.LABELS_RECORD_MODIFIER[1],required:!0},{label:"",desc:"==============================================",type:e.FieldType.Separator,required:!1},{label:"kintoneのフィールド設定",desc:"ChatGPTに問い合わせる入力フィールドと、回答を出力する出力フィールドを設定します。",type:e.FieldType.Label},{label:"入力フィールド選択",desc:"入力として使用するフィールドを選択してください",code:t.INPUT_FIELD,type:e.FieldType.Dropdown_FieldSelect,accept:["SINGLE_LINE_TEXT","MULTI_LINE_TEXT"],required:!0},{label:"出力フィールド選択",desc:"ChatGPTの返答を入力するフィールドを選択してください。",code:t.OUTPUT_FIELD,type:e.FieldType.Dropdown_FieldSelect,accept:["MULTI_LINE_TEXT"],required:!0}]),function(t){if(null==t)throw new Error("PLUGIN_ID == undefined で呼び出されました。");const n=l.preference,i=l.input;new e.ConfigManager(t,i,n).build()}(kintone.$PLUGIN_ID)})()})();