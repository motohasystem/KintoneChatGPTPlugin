(()=>{var e={82:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FieldType=void 0,function(e){e[e.Dropdown=0]="Dropdown",e[e.Dropdown_FieldSelect=1]="Dropdown_FieldSelect",e[e.Radio=2]="Radio",e[e.Text=3]="Text",e[e.Number=4]="Number",e[e.MultilineText=5]="MultilineText",e[e.Checkbox=6]="Checkbox",e[e.IncrementalTable=7]="IncrementalTable",e[e.Label=8]="Label",e[e.Separator=9]="Separator"}(t.FieldType||(t.FieldType={}))},518:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigBuilder=void 0,n(754);const l=n(796),o=n(787),r=n(505),s=n(128);class a{constructor(e,t){i(this,"props",void 0),i(this,"layout",void 0),i(this,"config",void 0),i(this,"field_builder",void 0),this.props=e,this.config=t,this.field_builder=new r.FieldBuilder(e)}static is_layout_info(e){return!!a.LAYOUT_PARTS.includes(e)}static is_includes_layout_info(e){return e.reduce(((e,t)=>(a.is_layout_info(t)&&(e=!0),e)),!1)}build_incremental_table(e,t){const n=new s.IncrementalTableBuilder(e,t,this.field_builder).build(),i=e.table_cols.map((e=>{const t=l.Utils.createElement("span","title");t.textContent=e.header;return l.Utils.createElement("th","kintoneplugin-table-th",[t])}));i.push(l.Utils.createElement("th","kintoneplugin-table-th-blankspace"));const o=l.Utils.createElement("tr","",i),r=l.Utils.createElement("thead","",[o]),a=l.Utils.createElement("tbody","",n);return l.Utils.createElement("table","kintoneplugin-table ms-0",[r,a],"",{id:"table-".concat(e.code)})}static get_grand_tr(e){if(null==e)throw"ERROR: nullが渡されたため祖父要素を取得できません";const t=e,n=null==t?void 0:t.parentNode;return null==n?void 0:n.parentNode}static get_formparts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n={};for(const i in e){if(!e.hasOwnProperty(i))continue;const l=e[i],o=l.label,r=l.code,s=l.type;t.includes(s)&&(n[r]={code:r,label:o,option:s})}const i=Object.keys(n).map((e=>({key:e,value:n[e]}))).sort(((e,t)=>e.value.label.toString().toLowerCase()<t.value.label.toString().toLowerCase()?-1:e>t?1:0));return Object.assign({},...i.map((e=>({[e.key]:e.value}))))}static addOnChangeEvent(e){for(const t of e)t.addEventListener("change",(e=>{const t=e.target;if(null==t)return;const n=t[t.selectedIndex];let i=n.getAttribute("option");null==i&&(i="");let l=n.getAttribute("code");null==l&&(l="");const o=t.closest("tr");if(null==o)return;const r=o.getElementsByTagName("input");r[0].value=i,r[1].value=l}))}static build_fields_dropdown(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const r=a.get_formparts(e,t),s=l.Utils.createElement("select","select-kintone-field");if(s.id=i,null!=o){const e=l.Utils.createElement("option");e.label=o,s.appendChild(e)}for(const e in r){const t=r[e],i=l.Utils.createElement("option");i.setAttribute("fieldcode",e),i.label=t.label,e==n&&i.setAttribute("selected",""),s.appendChild(i)}return l.Utils.createElement("div","",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[s])])])}static async build_fields_dropdown_other_app(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(null==e||e==o.ConfigUtilities.DEFAULT_OPTION){const e=l.Utils.createElement("select","select-kintone-field");if(e.id=i,null!=r){const t=l.Utils.createElement("option");t.label=r,e.appendChild(t)}return l.Utils.createElement("div","",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[e])])])}const s=await kintone.api("/k/v1/app/form/fields","GET",{app:parseInt(e)});return this.build_fields_dropdown(s.properties,t,n,i,r)}static make_parts_block(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";const o=l.Utils.buildElement({tagName:"div",className:"mb-3",textContent:n}),r=l.Utils.buildElement({tagName:"div",className:"h4 mb-2",textContent:t});return l.Utils.buildElement({tagName:"div",className:i+" ms-4 mt-4",childElements:[r,o,e]})}static addFieldSelectEvent(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;kintone.api("/k/v1/app/form/fields","GET",{app:n}).then((n=>{var o,r;const s=Object.keys(n.properties).map((e=>n.properties[e])).filter((e=>"SINGLE_LINE_TEXT"==e.type)).map((e=>({code:e.code,label:e.label,option:e.type}))).map((e=>{const t=l.Utils.createElement("option","");return t.label=e.label,t.setAttribute("code",e.code),t.setAttribute("option",e.option),e.code==i&&t.setAttribute("selected",""),t})),a=l.Utils.createElement("select","select-kintone-field",s);a.addEventListener("change",(e=>{var n;const i=e.target;if(null==i)return;const l=i[i.selectedIndex],o=c(l);null===(n=t.firstChild)||void 0===n||n.remove(),t.appendChild(o)}));const c=e=>{let t;e?(t=e.getAttribute("code"),null==t&&(t="")):t="";const n=l.Utils.createElement("input","kintoneplugin-input-text",[]);n.setAttribute("value",t),n.setAttribute("disabled","");return l.Utils.createElement("td","kintoneplugin-table-td-control",[l.Utils.createElement("div","kintoneplugin-table-td-control-value",[l.Utils.createElement("div","kintoneplugin-input-outer",[n])])])},d=l.Utils.createElement("div","kintoneplugin-table-td-control-value",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[a])])]);null===(o=e.firstChild)||void 0===o||o.remove(),e.appendChild(d),null===(r=t.firstChild)||void 0===r||r.remove();const u=a.item(a.selectedIndex),p=c(u);t.appendChild(p)}))}static set_switch_event(e,t,n){e.querySelectorAll('input[type="radio"]').forEach((e=>{e.addEventListener(t,n)}))}make_string_block(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");const n=e.code;let i=this.config[n];null==i&&(i=null!=e.default?e.default:"");const o="string-".concat(n),r=l.Utils.createElement("div","kintoneplugin-input-outer",[l.Utils.ce("input","kintoneplugin-input-text",[],"",{type:t,id:o,value:i})]);return a.make_parts_block(r,e.label,e.desc)}make_checkbox_block(e){if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");if(null==e||null==e.accept)throw new Error("ConfigBuidler.make_checkbox_block(): 必要なプロパティ accept が未定義です。設定を見直してください。");const t=e.code;let n=this.config[t];null==n&&(n=[]);const i="checkbox-".concat(t),o=e.accept.map((e=>{const t="".concat(i,"-").concat(e),o={type:"checkbox",name:"checkbox",value:e,id:t};return n.includes(e)&&(o.checked="checked"),l.Utils.createElement("div","kintoneplugin-input-checkbox",[l.Utils.ce("span","kintoneplugin-input-checkbox-item",[l.Utils.ce("input","kintoneplugin-input-checkbox-item",[],"",o),l.Utils.ce("label","",[],e,{for:t})])])}));return a.make_parts_block(l.Utils.ce("div","",o,"",{id:i}),e.label,e.desc)}make_radio_block(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");const n=e.code,i=this.config[n];if(null==e||null==e.accept)throw new Error("ConfigBuidler.make_dropdown_fieldselect_block(): 必要なプロパティ accept が未定義です。設定を見直してください。");const o=e.accept.map((e=>{const t="radio-".concat(n,"-").concat(e),o="radio-".concat(n),r=l.Utils.createElement("input");r.setAttribute("type","radio"),r.setAttribute("name",o),r.setAttribute("value",e),r.setAttribute("id",t),e==i&&r.setAttribute("checked","checked");const s=l.Utils.createElement("label","",[],e);return s.setAttribute("for",t),l.Utils.createElement("span","kintoneplugin-input-radio-item",[r,s])})),r=l.Utils.createElement("div","kintoneplugin-input-radio",o);r.id=n;return a.make_parts_block(r,e.label,e.desc,t)}make_dropdown_fieldselect_block(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const i=[],l=[];if(null==e.accept)throw new Error("ConfigBuidler.make_dropdown_fieldselect_block(): 必要なプロパティ accept が未定義です。設定を見直してください。");if(e.accept.forEach((e=>{a.is_layout_info(e)?l.push(e):i.push(e)})),null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");if(l.length>0&&null==this.layout)throw new Error("レイアウト情報をロードしていません。load_layout_info() を事前に呼び出してください。");if(l.length>0&&i.length>0)throw new Error("フォーム情報のフィールドとレイアウト情報のフィールドとが混在したドロップダウンは構築できません。");const o=e.code,r=this.config[o];let s;if(i.length>0)s=a.build_fields_dropdown(this.props,i,r,o,t);else{if(!(l.length>0))throw new Error("フォーム情報またはレイアウト情報が空欄で呼び出されました");s=a.build_fields_dropdown(this.layout,l,r,o,t)}return a.make_parts_block(s,e.label,e.desc,n)}make_incremental_table_block(e){if(null==this.config||null==this.props)throw new Error("インスタンスが初期化されていません");const t=e.code,n=this.config[t],i=this.build_incremental_table(e,n);return a.make_parts_block(i,e.label,e.desc)}make_subtitle_block(e){const t=l.Utils.ce("div","display-6 mb-3",[],e.label),n=l.Utils.ce("div","ms-4 mt-2 mb-5",[],e.desc);return l.Utils.createElement("div","",[t,n])}async load_layout_info(){const e=(await kintone.api("/k/v1/preview/app/form/layout","GET",{app:kintone.app.getId()})).layout.reduce(((e,t)=>{if("GROUP"==t.type){const n=t.layout.reduce(((e,t)=>{const n=t.fields.filter((e=>"SPACER"==e.type));return e=e.concat(n)}),[]);e.concat(n)}else e=e.concat(t.fields.filter((e=>"SPACER"==e.type)));return e}),[]);this.layout=e.reduce(((e,t)=>(t.code=t.elementId,t.label=t.elementId,e[t.code]=t,e)),{})}}i(a,"LAYOUT_PARTS",["SPACER"]),t.ConfigBuilder=a},716:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigManager=void 0,n(754);const l=n(787),o=n(518),r=n(82),s=n(796);t.ConfigManager=class{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;i(this,"KEY_CONFIG","config"),i(this,"setting_input",void 0),i(this,"config",{}),i(this,"hooks",{});const l=kintone.plugin.app.getConfig(e);this.set_config(l),this.setting_input=t,n&&this.set_preference(n)}set_preference(e){const t=document.getElementById("plugin_title");t&&(t.textContent=e.title);const n=document.getElementById("plugin_description");n&&(n.textContent=e.description)}build(){kintone.api("/k/v1/preview/app/form/fields","GET",{app:kintone.app.getId()}).then((async e=>{const t=this.make_setting_fields(e.properties),n=this.make_button_submit(),i=this.make_button_cancel(),l=(async()=>{const e=s.Utils.createElement("form","",await t);return e.id="form_settings",e})(),o=document.getElementById("config_body");null==o||o.appendChild(await l);const r=s.Utils.createElement("div","mt-5",[i,n]);null==o||o.appendChild(r)})).then((e=>{this.call_target_event("load")})).catch((e=>{throw e}))}async call_target_event(e){const t=this.hooks[e];if(null!=t)for(const e of t)null!=e&&await e()}layout_inputs(e,t){return t.map((t=>this.make_paragraph(e,t)))}make_paragraph(e,t){switch(t.type){case r.FieldType.Text:return e.make_string_block(t);case r.FieldType.Radio:return e.make_radio_block(t);case r.FieldType.Number:return e.make_string_block(t,"number");case r.FieldType.Checkbox:return e.make_checkbox_block(t);case r.FieldType.IncrementalTable:return e.make_incremental_table_block(t);case r.FieldType.Label:return e.make_subtitle_block(t);case r.FieldType.Separator:return s.Utils.createElement("div","mt-5 bg-info");case r.FieldType.Dropdown_FieldSelect:if(!("accept"in t))throw new Error("プロパティ accept が必要です。config/settings.ts の設定を見直してください。");return e.make_dropdown_fieldselect_block(t);default:throw new Error("未実装のFieldTypeを要求しています。".concat(t.type," を実装してください。"))}}set_config(e){const t=s.Utils.get_from(e,this.KEY_CONFIG,"");""==t||(this.config=JSON.parse(t))}get_config(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(null==e)return this.config;if(e in this.config)return this.config[e];throw new Error("未定義または未設定の設定キーが指定されました: [".concat(e,"]"))}async make_setting_fields(e){const t=new o.ConfigBuilder(e,this.config);return await t.load_layout_info(),this.layout_inputs(t,this.setting_input)}store_parameters(){const e={},t=document.getElementById("form_settings");if(null==t)throw new Error("ERROR: フォーム要素を取得できませんでした。");const n=new l.ConfigUtilities(t);return this.setting_input.forEach((t=>{if(t.type==r.FieldType.Label||t.type==r.FieldType.Separator)return;const i=t.code,l=t.required,o=n.get_selected(i,t.type);if(o)e[i]=o;else{if(l){const e="必須の設定項目 [".concat(t.label,"] が未設定です(").concat(i,")");throw new Error(e)}e[i]=""}})),e}make_button_submit(){const e=s.Utils.createElement("button","kintoneplugin-button-dialog-ok");return e.setAttribute("type","button"),e.textContent="適用",e.addEventListener("keydown",(e=>{if(e.isComposing||"Enter"==e.code)return!1})),e.addEventListener("click",(async e=>{e.preventDefault();if(null==document.getElementById("form_settings"))throw"ERROR: フォーム要素を取得できませんでした。";await this.call_target_event("submit");try{const e=JSON.stringify(this.store_parameters()),t={};t[this.KEY_CONFIG]=e,kintone.plugin.app.setConfig(t,(function(){alert("🆙 プラグイン設定を保存しました。アプリの更新をお忘れなく！"),window.location.href="../../flow?app="+kintone.app.getId()}))}catch(e){alert("⚠️ ".concat(e))}})),e}make_button_cancel(){const e=s.Utils.createElement("button","js-cancel-button kintoneplugin-button-dialog-cancel");return e.textContent="キャンセル",e.addEventListener("click",(function(e){window.location.href="../../"+kintone.app.getId()+"/plugin/"})),e}add_hook(e,t){var n;null==this.hooks[e]&&(this.hooks[e]=[]),null===(n=this.hooks[e])||void 0===n||n.push(t)}}},787:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigUtilities=void 0;const l=n(796),o=n(82);class r{constructor(e){i(this,"config_form",void 0),i(this,"whole_selected_field_codes",void 0),i(this,"add_selected_field_codes",(e=>{this.whole_selected_field_codes.push(e)})),i(this,"get_selected_fieldcode",(e=>{const t=document.getElementById(e);if(-1==t.selectedIndex)return"";if(t.options[t.selectedIndex].label==r.DEFAULT_OPTION)return"";const n=t.selectedOptions[0].getAttribute("fieldcode");if(null==n)throw new Error("ノード[ ".concat(e," ]はフィールド選択ではありません。"));return n})),i(this,"get_selected_label",(e=>{const t=document.getElementById(e);return-1==t.selectedIndex?"":t.selectedOptions[0].label})),this.config_form=e,this.whole_selected_field_codes=[]}is_overlapped(e){return l.Utils.is_overlapped(this.overlapped(e))}overlapped(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return null!=e&&this.whole_selected_field_codes.concat(e),l.Utils.overlapped(this.whole_selected_field_codes)}clear_selected_field_labels(){this.whole_selected_field_codes=[]}get_selected_radio(e){const t="radio-".concat(e),n=document.getElementsByName(t),i=n.length;for(let e=0;e<i;e++){const t=n[e];if(1==t.checked)return t.value}return""}get_string_value(e){const t="string-".concat(e);return document.getElementById(t).value}get_incremental_table_values(e){const t="table-".concat(e),n=document.getElementById(t);if(null==n)throw new Error("指定したテーブルが見つかりません。(id: ".concat(t,")"));return this.abstruct_from_incremental_table(n)}abstruct_from_incremental_table(e){const t=Array.from(e.rows).filter((e=>{var t;return"TH"==(null===(t=e.firstChild)||void 0===t?void 0:t.nodeName)})).map((e=>Array.from(e.cells).filter((e=>""!=e.innerText)).map((e=>e.innerText))))[0],n=Array.from(e.rows).filter((e=>{var t;return"TH"!=(null===(t=e.firstChild)||void 0===t?void 0:t.nodeName)})).map((e=>Array.from(e.cells).filter((e=>{const t=e.getElementsByClassName("kintoneplugin-input-text")[0],n=e.getElementsByClassName("select-kintone-field")[0],i=e.getElementsByClassName("kintoneplugin-input-checkbox-item");return void 0!==t||void 0!==n||void 0!==i})).map((t=>{const n=t.getElementsByClassName("kintoneplugin-input-text")[0];if(null!=n)return n.value;const i=t.getElementsByClassName("select-kintone-field")[0];if(null!=i){const e=i.selectedIndex,t=i[e];if("fieldcode"in i[e].attributes){const e=t.getAttribute("fieldcode");if(null!=e)return e}return i[e].label}const l=t.getElementsByClassName("kintoneplugin-input-checkbox");if(null!=l)return Array.from(l).filter((e=>e.childNodes[0].childNodes[0].checked)).map((e=>{if(null==e.textContent)throw new Error("ラベルのないチェックボックスが定義されています。");return e.textContent}));throw new Error("未対応のテーブルセル ".concat(e," が渡されました。"))}))));if(0==n.filter((e=>e.length>0)).filter((e=>e.filter((e=>e.length>0)).length>0)).length)return null;return n.map((e=>e.reduce(((e,n,i)=>(e[t[i]]=n,e)),{})))}get_selected(e,t){switch(t){case o.FieldType.Dropdown:case o.FieldType.Checkbox:return this.get_selected_label(e);case o.FieldType.Radio:return this.get_selected_radio(e);case o.FieldType.Dropdown_FieldSelect:return this.get_selected_fieldcode(e);case o.FieldType.Text:return this.get_string_value(e);case o.FieldType.IncrementalTable:return this.get_incremental_table_values(e)}throw new Error("get_selected(): 不明なフィールドタイプが渡されました (field_type: ".concat(t,")"))}}i(r,"DEFAULT_OPTION","----"),t.ConfigUtilities=r},505:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.FieldBuilder=void 0;const l=n(796),o=n(82),r=n(518);t.FieldBuilder=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"----";i(this,"props",void 0),i(this,"empty_label",void 0),i(this,"build_textcell",(e=>(e=void 0===e?"":e,l.Utils.createElement("div","kintoneplugin-input-outer",[l.Utils.createElement("input","kintoneplugin-input-text",[],void 0,{type:"text",value:e})])))),i(this,"build_checkbox_cell",((e,t,n,i)=>{const o=t.accept.map((t=>{const o="".concat(n,"-").concat(i,"-").concat(t),r=(e=void 0===e?[]:e).includes(t)?"checked":"",s=l.Utils.ce("input","",[],"",{type:"checkbox",name:"checkbox",value:t,id:o});return""!=r&&s.setAttribute("checked",r),l.Utils.ce("div","kintoneplugin-input-checkbox",[l.Utils.createElement("span","kintoneplugin-input-checkbox-item",[s,l.Utils.ce("label","",[],t,{for:o})])])}));return l.Utils.createElement("div","",o)})),i(this,"build_dropdown_cell",((e,t)=>{if(null==t||!("accept"in t))throw new Error("選択肢情報としてundefinedが渡されました。");e=void 0===e?"":e;const n=l.Utils.createElement("select","select-kintone-field");if(null!=t.empty_label){const e=l.Utils.createElement("option");e.label=t.empty_label,n.appendChild(e)}return t.accept.forEach((t=>{const i=l.Utils.createElement("option");i.label=t,t==e&&i.setAttribute("selected",""),n.appendChild(i)})),l.Utils.createElement("div","",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[n])])])})),i(this,"build_dropdown_fieldselect_cell",((e,t)=>{if(null==t||!("accept"in t))throw new Error("選択肢情報としてundefinedが渡されました。");const n=r.ConfigBuilder.get_formparts(this.props,t.accept),i=l.Utils.createElement("select","select-kintone-field");i.id=void 0===e?"":e;const o=l.Utils.createElement("option");o.label=this.empty_label,i.appendChild(o);for(const t in n){const o=n[t],r=l.Utils.createElement("option");r.setAttribute("fieldcode",t),r.label=o.label,t==e&&r.setAttribute("selected",""),i.appendChild(r)}return l.Utils.createElement("div","",[l.Utils.createElement("div","kintoneplugin-select-outer",[l.Utils.createElement("div","kintoneplugin-select",[i])])])})),this.props=e,this.empty_label=t}build_table_cell(e,t,n,i){if("accept"in t)switch(t.type){case o.FieldType.Checkbox:return this.build_checkbox_cell(n,t,e,i);case o.FieldType.Dropdown:return this.build_dropdown_cell(n,t);case o.FieldType.Dropdown_FieldSelect:return this.build_dropdown_fieldselect_cell(n,t)}else if(t.type===o.FieldType.Text)return this.build_textcell(n);throw new Error("未定義のFieldTypeが渡されました。FieldTypeに".concat(t.type," を実装してください。"))}}},128:(e,t,n)=>{"use strict";function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.IncrementalTableBuilder=void 0;const l=n(796),o=n(518);t.IncrementalTableBuilder=class{constructor(e,t,n){i(this,"table_conf",void 0),i(this,"saved_rows",void 0),i(this,"table_rows",void 0),i(this,"field_builder",void 0),i(this,"rows_count",void 0),this.table_conf=e,this.saved_rows=t,this.field_builder=n,this.table_rows=[],this.rows_count=0}build(){const e=this.table_conf.table_cols,t=e.length-3;return null==this.saved_rows||0==Object.keys(this.saved_rows).length?this.table_rows.push(this.build_table_row(0,e,void 0,t)):this.saved_rows.forEach(((n,i)=>{const l=this.build_table_row(i,e,n,t);this.table_rows.push(l)})),this.table_rows}build_table_row(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=[];for(let i=0;i<t.length;i++){const r=t[i],s=null==n?void 0:n[r.header],a=this.field_builder.build_table_cell(this.table_conf.code,r,s,e);o.push(l.Utils.ce("td","",[l.Utils.ce("div","kintoneplugin-table-td-control",[l.Utils.ce("div","kintoneplugin-table-td-control-value",[a])])]))}const r=this.create_button_row_add(t),s=this.create_button_row_remove();i=i<0?0:i;const a=[...Array(i)].map((()=>l.Utils.createElement("td","td_spacer"))),c=[...o,...a,l.Utils.createElement("td","kintoneplugin-table-td-operation",[r,s])];this.rows_count=o.length;return l.Utils.createElement("tr","",c)}get_table_rows_count(){const e="table-".concat(this.table_conf.code),t=document.getElementById(e);if(t)return t.getElementsByTagName("tr").length;throw new Error("指定したテーブルID ".concat(e," が存在しません。"))}create_button_row_add(e){const t=document.createElement("button");return t.className="kintoneplugin-button-add-row-image",t.setAttribute("type","button"),t.setAttribute("title","Add row"),t.addEventListener("click",(t=>{const n=o.ConfigBuilder.get_grand_tr(t.target),i=null==n?void 0:n.parentNode;if(null==n||null==i)throw"ERROR: 祖先のtbodyを取得できませんでした。";if(null==(null==t?void 0:t.target))return;const l=n.children.length-1-e.length,r=this.get_table_rows_count()+1,s=this.build_table_row(r,e,void 0,l);i.insertBefore(s,n.nextElementSibling)})),t}create_button_row_remove(){const e=document.createElement("button");return e.className="kintoneplugin-button-remove-row-image",e.setAttribute("type","button"),e.setAttribute("title","Delete this row"),e.addEventListener("click",(e=>{var t,n;const i=o.ConfigBuilder.get_grand_tr(e.target);1!=(null===(t=i.parentNode)||void 0===t?void 0:t.childNodes.length)&&(null===(n=i.parentNode)||void 0===n||n.removeChild(i))})),e}}},580:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),l=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),l(n(518),t),l(n(716),t),l(n(787),t),l(n(505),t),l(n(128),t),l(n(82),t)},754:e=>{e.exports={}},715:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonInstaller=void 0;const i=n(177);n(754);t.ButtonInstaller=class{class_hms_button="button-hms-items";buttons=[];canvas;constructor(e=""){""!=e&&(this.class_hms_button=e)}create_button(e,t=""){const n=i.Utils.ce("span","",[],e);n.style.color="dodgerblue";let l=i.Utils.ce("button",this.class_hms_button,[n],"",{title:t});return l=i.Utils.decorate_menu_icon(l),e.length>2&&(l.style.fontSize="16px"),l}add_button(e){this.buttons.push(e)}install(){this.already_installed()||0!=this.buttons.length&&this.put_buttons(this.buttons)}set_canvas(e){this.canvas=e}get_hms(){const e=kintone.app.getHeaderMenuSpaceElement();if(null==e){throw new Error("ボタン配置スペースが取得できませんでした。")}return e}already_installed(){return document.getElementsByClassName(this.class_hms_button).length>0}put_buttons(e){const t=void 0===this.canvas?this.get_hms():this.canvas;e.forEach((e=>{t.append(e)}))}get_header_element(e){const t=document.querySelectorAll(".recordlist-header-label-gaia");return Array.from(t).filter((t=>t.textContent==e))}}},796:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),l=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),l(n(177),t),l(n(715),t),l(n(23),t)},23:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluginCanvas=void 0;const i=n(177);n(754);class l{static CLASS_DISMISS="offcanvas-dismiss";id_island;id_offcanvas;title_offcanvas;island;enable_offcanvas;constructor(e,t,n=null,l){if(this.title_offcanvas=e,this.id_island=`plugin_island_id_${t}`,this.id_offcanvas=`offcanvas_${this.id_island}`,""==t){if(null==n&&(n=kintone.app.getHeaderMenuSpaceElement()),null==n)throw new Error("kintone.app.HeaderMenuSpaceElement() を取得できませんでした。");return this.island=n,void(this.enable_offcanvas=!1)}this.enable_offcanvas=!0;const o=document.getElementById(this.id_island);if(o)this.island=o;else{const e=(e=>{if(e)return e;{const e=i.Utils.ce("span","",[],"🎈");return e.style.cursor="pointer",e}})(l);e.style.color="dodgerblue";let t=i.Utils.ce("div","bbk-tool-icon-box",[e],"",{id:this.id_island,"data-bs-toggle":"offcanvas","aria-controls":this.id_offcanvas,"data-bs-target":`#${this.id_offcanvas}`});t=i.Utils.decorate_menu_icon(t),this.island=t,this.init_offcanvas()}}init_offcanvas(){const e=kintone.app.getHeaderMenuSpaceElement();e&&(e.appendChild(this.get_node()),e.appendChild(this.build_node_offcanvas()))}get_node(){return this.island}build_node_offcanvas(){return i.Utils.ce("div","offcanvas offcanvas-start",[i.Utils.ce("div","offcanvas-header",[i.Utils.ce("h5","offcanvas-title",[],this.title_offcanvas,{id:`${this.id_offcanvas}Label`}),i.Utils.ce("button","btn-close text-reset",[],"",{"data-bs-dismiss":"offcanvas","aria-label":"Close"})]),i.Utils.ce("div","offcanvas-body",[i.Utils.ce("div","mb-4",[],"ここから各種プラグインを呼び出せます。")],"",{id:`${this.id_offcanvas}-body`})],"",{tabindex:"-1",id:`${this.id_offcanvas}`,"aria-labelledby":`${this.id_offcanvas}Label`,"data-bs-backdrop":"false"})}append(e){if(this.enable_offcanvas){const t=document.getElementById(`${this.id_offcanvas}-body`);this.deal_dismiss_attribute(e),t?.appendChild(e)}else this.island.append(e)}deal_dismiss_attribute(e){const t=Array.from(e.querySelectorAll(`.${l.CLASS_DISMISS}`));t.length>0?t.map((e=>{e.setAttribute("data-bs-dismiss","offcanvas")})):e.setAttribute("data-bs-dismiss","offcanvas")}}t.PluginCanvas=l},177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;class n{static unique_properties(e,t=!1){const n=[];for(const i of Object.keys(e)){const l=e[i];(1==l.unique||t&&"RECORD_NUMBER"==l.type)&&n.push(l)}return n}static is_not_empty_string(e){return!n.is_empty_string(e)}static is_empty_string(e){return null==e||null==e||!(e.length>0)}static get_from=(e,t,n)=>e.hasOwnProperty(t)?e[t]:n;static buildElement=e=>{const t=e.tagName,i=e.className?e.className:"",l=e.childElements?e.childElements:[],o=e.textContent?e.textContent:"",r=e.attrs?e.attrs:{};return n.createElement(t,i,l,o,r)};static createElement=(e,t="",n=[],i="",l)=>{const o=document.createElement(e);return o.className=t,o.textContent=i,n.length>0&&n.forEach((e=>{o.appendChild(e)})),l&&Object.entries(l).forEach((([e,t])=>{o.setAttribute(e,t)})),o};static ce=(e,t="",n=[],i="",l)=>this.createElement(e,t,n,i,l);static decorate_menu_icon(e){return e.style.height="48px",e.style.backgroundColor="#f7f9fa",e.style.fontSize="28px",e.style.border="1px solid #e3e7e8",e.style.display="inline",e.style.marginLeft="2px",e.style.marginRight="2px",e.style.verticalAlign="middle",e}static simpleDiv=e=>n.createElement("div","",[],e);static is_overlapped=e=>n.overlapped(e).length>0;static overlapped=e=>{const t=e.filter(((e,t,n)=>n.indexOf(e)!==n.lastIndexOf(e)));return Array.from(new Set(t))};static get_application_url(e){return`${location.protocol}//${location.host}/k/${e}`}static retrieve_errors(e,t=-1){const n=e?.error?.errors;if(null==n)return;let i=[];if(Object.keys(n).forEach((e=>{const t=n[e].messages.map((t=>`[${e}] ${t}`));i=i.concat(t)})),i.sort(),t>=0&&t<i.length){const e=i.length-t;i=i.splice(0,t),i.push(`以下${e}件のエラーメッセージを省略しました。`)}return i}}t.Utils=n}},t={};function n(i){var l=t[i];if(void 0!==l)return l.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}(()=>{"use strict";var e=n(580);const t="api_key",i="static_prompt",l="input_field",o="output_field",r="btn_space_field";function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{}s(a,"preference",{title:"ChatGPT連携プラグインの設定",description:""}),s(a,"input",[{label:"ChatGPTの設定",desc:"API呼び出しに必要な項目を指定します。",type:e.FieldType.Label},{label:"API Key",desc:"ChatGPT APIのAPI Tokenを指定してください。",code:t,type:e.FieldType.Text,required:!0},{label:"固定プロンプト",desc:"入力として毎回渡す固定のプロンプトを記入してください。",code:i,type:e.FieldType.Text,accept:["MULTI_LINE_TEXT"],required:!0},{label:"",desc:"",type:e.FieldType.Separator,required:!1},{label:"kintoneのフィールド設定",desc:"入出力フィールドなどを設定します。",type:e.FieldType.Label},{label:"入力フィールド選択",desc:"入力として使用するフィールドを選択してください",code:l,type:e.FieldType.Dropdown_FieldSelect,accept:["SINGLE_LINE_TEXT","MULTI_LINE_TEXT"],required:!0},{label:"出力フィールド選択",desc:"ChatGPTの返答を入力するフィールドを選択してください。",code:o,type:e.FieldType.Dropdown_FieldSelect,accept:["MULTI_LINE_TEXT"],required:!0},{label:"実行ボタン配置スペース選択",desc:"API呼び出しを実行するボタンを配置するスペースを選択してください。",code:r,type:e.FieldType.Dropdown_FieldSelect,accept:["SPACER"],required:!0}]),function(t){if(null==t)throw new Error("PLUGIN_ID == undefined で呼び出されました。");const n=a.preference,i=a.input;new e.ConfigManager(t,i,n).build()}(kintone.$PLUGIN_ID)})()})();